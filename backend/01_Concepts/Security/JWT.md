## JWT란?

> 인증에 필요한 정보들을 암호화 시킨 JSON 토큰을 의미한다.

- JWT기반 인증은 JWT 토큰(Access Token)을 HTTP 헤더(hewader)에 실어 서버가 클라이언트를 식별하는 방식이다

![[JWT1.png]]

- 위의 사진과 같이 서버에서 회원임을 확인후, 토큰을 발행해서 사용자에게 전달하고 사용자는 이를 로컬스토리지에 저장함으로 토큰을 서버나 DB에서 저장하고 있지 않는 _**무상태를 유지**_

## JWT의 구조

![[JWT2.png]]

- Header: JWT에서 사용할 타입과 해싱 알고리즘이 담겨 있다.
- Payload: 서버에서 첨부한 사용자 권한 정보와 데이터가 담겨 있다.
- Signature: Header, Payload를 Base64 URL -safe Encode한 이후 Header에 명시된 해시함수를 적용해 개인키로 서명한 전자 서명이 담겨있다.

### Header

> 두가지 정보를 지닌다.

typ: 토큰의 타입을 지정. 바로 JWT

alg: 해싱 알고리즘을 지정, 보통 HS256, RSA가 사용되며, 이 알고리즘은 Signature에서 사용됨.

---

### Payload(정보)

> Payload 부분에는 토큰에 담을 정보가 들어있다.

여기에 담는 정보의 한 ‘조각’ 을 클레임(claim) 이라고 부르고, 이는 key-value 의 한 쌍으로 이뤄져있다. 토큰에는 여러개의 클레임 들을 넣을 수 있다.

즉, 서버와 클라이언트가 주고받는 시스템에서 실제로 사용될 정보에 대한 내용을 담고 있는 섹션이다.

페이로드에는 정해진 데이터 타입은 업싲만 크게 3가지 클레임으로 나뉜다.

- Registered claims(등록된 클레임)
- Public claims(공개된 클레임)
- Private claims(비공개 쿨레임)

### Registed claims

등록된 클레임들은 서비스에서 필요한 정보들이 아닌, 토큰에 대한 정보들을 담기위하여 이름이 이미 정해진 클레임들입니다. 등록된 클레임의 사용은 모두 선택적 (optional)이며, 이에 포함된 클레임 이름들은 다음과 같습니다:

iss: 토큰 발급자 (issuer)

sub: 토큰 제목 (subject)

aud: 토큰 대상자 (audience)

exp: 토큰의 만료시간 (expiraton), 언제나 현재 시간보다 이후로 설정.

nbf: Not Before 를 의미하며, 토큰의 활성 날짜와 비슷한 개념. 이 날짜가 지나기 전까지는 토큰이 처리되지 않는다.

iat: 토큰이 발급된 시간 (issued at)

jti: JWT의 고유 식별자(ID)로서, 주로 중복적인 처리를 방지하기 위하여 사용됩니다. 일회용 토큰에 사용하면 유용합니다.

### Public claims

공개 클레임들은 충돌이 방지된 (collision-resistant) 이름을 가지고 있어야 합니다.

충돌을 방지하기 위해서는, 클레임 이름을 URI 형식으로 짓는다.

```
{
    "<https://abcd123.com/jwt_claims/is_admin>": true
}
```

## Private claims

해당하는 당사자들 간에 정보를 공유하기 위해 만들어진 사용자 지정 클레임.

외부에 공개되도 상관없지만 해당 유저를 특정할 수 있는 정보들을 담는다.

공개 클레임과는 달리 이름이 중복되어 충돌이 될 수 있으니 사용할때에 유의해야한다.

```
{
    "username": "kim"
}
```

### Payload 예제

```
{
    "iss": "velopert.com",
    "exp": "1485270000000",
    "<https://velopert.com/jwt_claims/is_admin>": true,
    "userId": "11028373727102",
    "username": "velopert"
}
```

위 예제 payload 는 2개의 등록된 클레임, 1개의 공개 클레임, 2개의 비공개 클레임으로 이뤄져있다.

---

### Signature(서명)

> 시그니처에서 사용하는 알고리즘은 헤더에서 정의한 알고리즘 방식(alg)을 활용한다.

시그니처의 구조는 (헤더 + 페이로드)와 서버가 갖고 있는 유일한 key 값을 합친 것을 헤더에서 정의한 알고리즘으로 암호화를 한다.

![[JWT3.png]]

---

## **JWT를 이용한 인증과정**
![[JWT4.png]]